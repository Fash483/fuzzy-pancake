version: 1.0.{build}
image: Ubuntu

branches:
  only:
    - Sera

install:
  - sudo apt update
  - sudo apt install -y nodejs npm curl python3 python3-pip
  - npm install webtorrent-cli

build_script:
  - |
    echo "Starting torrent download..."
    mkdir downloads
    npx webtorrent download "magnet:?xt=urn:btih:66092C96207B7EC52A67E812CC7071433EC6D050&dn=Kurniawan%20T.%20Handbook%20of%20Microplastic%20Pollution%20in%20the%20Environment...2025&tr=udp://tracker.bittor.pw:1337/announce&tr=udp://tracker.opentrackr.org:1337/announce&tr=udp://tracker.dler.org:6969/announce&tr=udp://open.stealth.si:80/announce&tr=udp://tracker.torrent.eu.org:451/announce&tr=udp://exodus.desync.com:6969/announce&tr=udp://open.demonii.com:1337/announce" --out downloads
    echo "Downloading completed."

    # Set your base upload URL
    BASE_URL="https://filebin.net/Sahaujwsh/"

    # Find all files and upload each with filename appended
    find downloads -type f | while read -r file; do
      filename=$(basename "$file")
      upload_url="${BASE_URL}${filename}"
      echo "Uploading $file to $upload_url..."
      curl -X POST \
        "$upload_url" \
        -H 'accept: application/json' \
        -H 'Content-Type: application/octet-stream' \
        --data-binary "@$file"
    done
